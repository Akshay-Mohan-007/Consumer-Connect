<!--***************************************************************************************************************************************
 * NAME   : CC_TargetingCriteria
 * DESCRIPTION  :Targeting Criteria Page
 *    
 * @AUTHOR   : Sayari Mandal
 * @DATE   : 12-12-2017
 *
 * MODIFICATION LOG:  
 * ***************************************************************************************************************************************
 * DEVELOPER               DATE               DESCRIPTION 
 * ***************************************************************************************************************************************
 * Sayari Mandal           12-12-2017         Initial Version
 * Debalina                12-18-2017         JS/Validation and Backend Integration

 ****************************************************************************************************************************************-->


<aura:component extends="c:CC_BaseSuperComponent" controller="CC_TargetingCriteriaController" implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction" access="global">
    
    <aura:method name="save" action="{!c.save}" access="PUBLIC">
      <aura:attribute name="callback" type="Function"/>
    </aura:method>
    <aura:method name="submit" action="{!c.submit}" access="PUBLIC">
      <aura:attribute name="callback" type="Function"/>
    </aura:method>  
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />

    <aura:attribute name="bMeetCriteria" type="Boolean" default="true"/>
    <aura:attribute name="bReadOnly" type="Boolean" default="false"/>
    <aura:attribute name="bMeetAnotherCriteria" type="Boolean" default="false"/>
    <aura:attribute name="sAppDetailId" type="String" default="a0D18000002WRLI"/>
    <aura:attribute name="sAppDetailStatus" type="String"/>
    <aura:attribute name="sAppId" type="String"/>
    <aura:attribute name="mapLabels" type="Map" />
    <aura:attribute name="AppDetailInfo" type="CC_Application_Detail__c" />
    <aura:attribute name="sComments" type="String"/>
    <aura:attribute name="sWaiverProg" type="String"/>
    <aura:attribute name="sLabelComment" type="String"/>
    <aura:attribute name="lWaiverProg" type="List"/>
    <aura:attribute name="dDate" type="Date" description="dDate" />
    <aura:attribute name="dAppDate" type="Date" description="dDate" />
    <aura:attribute name="sDate" type="String" description="dDate" />
    <aura:attribute name="sTime" type="String" />
    <aura:attribute name="sTimeZone" type="String" />
    <aura:attribute name="lstTimeZone" type="List"/>
    <aura:attribute name="sTaskIdToClose" type="String" default="null"/> 
    <aura:attribute name="sConifrmDateLabel" type="String"/>
    <aura:attribute name="bIsDataLoaded" type="Boolean"/>
    <aura:attribute name="sCaseId" type="String"/>
    <!-- <aura:attribute name="DateTime" type="String" default="2017-12-15T12:44:00.000Z"/> -->
    <aura:attribute name="lstErrors" type="List"/>
    <aura:attribute name="bHasError" type="Boolean" default="false"/>
    
    <!-- <aura:attribute name="bTimeZoneError" type="Boolean" default="false"/>
    <aura:attribute name="bTimeError" type="Boolean" default="false"/>
    <aura:attribute name="bDateError" type="Boolean" default="false"/>   
    <aura:attribute name="bProgramError" type="Boolean" default="false"/>
    <aura:attribute name="bCommentError" type="Boolean" default="false"/> -->
    
    <c:CC_SubPageHeader iconName="standard:household" pageName="Targeting Criteria" 
					errorListShow="{!v.lstErrors.length> 0}" lstErrors='{!v.lstErrors}' />
    <aura:if isTrue="{!v.bIsDataLoaded}">
    <lightning:layout horizontalAlign="left" multipleRows="true">
        <lightning:layoutItem flexibility="grow" padding="around-small" size="12" largeDeviceSize="8" mediumDeviceSize="6" smallDeviceSize="7">
            <div class="slds-text-body_small slds-m-bottom_x-small">{!v.mapLabels.Individual_Meet_Waiver_Criteria} </div>
            <lightning:input type="radio"
                             disabled="{!v.bReadOnly}" 
                             label="{!v.mapLabels.CC_Yes}" 
                             name="MeetCriteria" 
                             checked="{!v.bMeetCriteria}" 
                             value="true" 
                             onchange="{!c.handleMeetCriteria}" />
            <lightning:input type="radio" 
                             disabled="{!v.bReadOnly}" 
                             label="{!v.mapLabels.CC_No}" 
                             name="MeetCriteria" 
                             checked="{!not(v.bMeetCriteria)}" 
                             value="false" 
                             onchange="{!c.handleMeetCriteria}"/> 
        </lightning:layoutItem>
        <lightning:layoutItem flexibility="grow" padding="around-small" size="12" largeDeviceSize="4" mediumDeviceSize="6" smallDeviceSize="5">
            <label class="slds-form-element__label slds-no-flex" >
                <span>{!v.mapLabels.Application_Date} </span>
            </label>
            <div class="slds-form-element__control slds-grow">
                <p>{!v.dAppDate}</p>
            </div>
        </lightning:layoutItem>
    </lightning:layout>
    
    <aura:if isTrue="{!v.bMeetCriteria == false}"> 
        <lightning:layout horizontalAlign="left" multipleRows="true">
            <lightning:layoutItem flexibility="grow" padding="around-small" size="12" largeDeviceSize="6" mediumDeviceSize="8" smallDeviceSize="12">
                
                <div class="slds-text-body_small slds-m-bottom_x-small">{!v.mapLabels.Individual_Meet_For_Another_Waiver}</div>
                <lightning:input type="radio" 
                                 disabled="{!v.bReadOnly}" 
                                 label="{!v.mapLabels.CC_Yes}" 
                                 name="MeetAnotherCriteria" 
                                 checked="{!v.bMeetAnotherCriteria}" 
                                 value="true" 
                                 onchange="{!c.handleMeetAnotherCriteria}"/>
                <lightning:input type="radio" 
                                 disabled="{!v.bReadOnly}" 
                                 label="{!v.mapLabels.CC_I_Don_t_Know}" 
                                 name="MeetAnotherCriteria" 
                                 checked="{!not(v.bMeetAnotherCriteria)}" 
                                 value="false" 
                                 onchange="{!c.handleMeetAnotherCriteria}"/> 
                
                
            </lightning:layoutItem>
        </lightning:layout>
    </aura:if>
    
    <aura:if isTrue="{!v.bMeetCriteria == true}"> 
        <lightning:layout horizontalAlign="left" multipleRows="true">
            <lightning:layoutItem flexibility="grow" padding="around-small" size="12" largeDeviceSize="4" mediumDeviceSize="8" smallDeviceSize="12">
             
                <ui:inputDate aura:id="confirmDate" 
                              disabled="{!v.bReadOnly}" 
                              value="{!v.dDate}" 
                              label="{!v.mapLabels.CC_Label_ConfirmDate}"
                              labelClass="slds-form-element__label slds-no-flex required-asterisk-datePicker"
                              class="{!and(v.bHasError,empty(v.dDate))? 'slds-input slds-has-error':'slds-input'}"
                              displayDatePicker="true" 
                              format="MM/DD/YYYY"/>
            </lightning:layoutItem>
            <lightning:layoutItem flexibility="grow" padding="around-small" size="12" largeDeviceSize="8" mediumDeviceSize="8" smallDeviceSize="12">
                <lightning:layout horizontalAlign="left" multipleRows="true">
                    <lightning:layoutItem flexibility="grow"  size="12" largeDeviceSize="6" mediumDeviceSize="8" smallDeviceSize="8">
                        <lightning:input type="time" 
                                         disabled="{!v.bReadOnly}" 
                                         label="{!v.mapLabels.Confirm_Time}" 
                                         name="time" 
                                         aura:id="confirmTimeId"
                                         value="{!v.sTime}"
                                         class="{!and(v.bHasError,empty(v.sTime))? 'slds-has-error required-asterisk':'required-asterisk'}"/>
                    </lightning:layoutItem>
                    <lightning:layoutItem flexibility="grow" size="12" largeDeviceSize="4" mediumDeviceSize="4" smallDeviceSize="4" class="slds-p-left_x-small">
                        <lightning:select name="timeZone"
                                          disabled="{!v.bReadOnly}"  
                                          label="{!v.mapLabels.CC_Select_Time_Zone}" 
                                          value="{!v.sTimeZone}"
                                          class="{! and(v.bHasError,empty(v.sTimeZone)) ? 'slds-has-error required-asterisk' : 'required-asterisk'}">
                        <aura:iteration items="{!v.lstTimeZone}" var="val">
                           <option text="{!val.sValue}" value="{!val.sKey}" selected ="{! val.sKey == v.sTimeZone}"/>
                        </aura:iteration>
                        </lightning:select>
                    </lightning:layoutItem>
                </lightning:layout>
            </lightning:layoutItem>
        </lightning:layout>
    </aura:if>
    
    <aura:if isTrue="{!v.bMeetAnotherCriteria == true}">
        <lightning:layout horizontalAlign="left" multipleRows="true">
            <lightning:layoutItem flexibility="grow" padding="around-small" size="12" largeDeviceSize="" mediumDeviceSize="8" smallDeviceSize="12">
                <lightning:select name="waiverName" 
                                  label="{!v.mapLabels.Select_Waiver_Targeting_Cretria}"
                                  value="{!v.sWaiverProg}"
                                  class="{! and(v.bHasError,empty(v.sWaiverProg)) ? 'slds-has-error required-asterisk' : 'required-asterisk'}"
                                  >
                    <aura:iteration items="{!v.lWaiverProg}" var="val">
                        <option text="{!val.sValue}" value="{!val.sKey}" selected ="{! val.sKey == v.sWaiverProg}"/>
                    </aura:iteration>
                </lightning:select>
            </lightning:layoutItem>
        </lightning:layout>
    </aura:if>
    
    <aura:if isTrue="{!v.bMeetCriteria == false}"> 
        <lightning:layout horizontalAlign="left" multipleRows="true">
            <lightning:layoutItem flexibility="grow" padding="around-small" size="12" largeDeviceSize="6" mediumDeviceSize="8" smallDeviceSize="12">
                <lightning:textarea name="" 
                                    value="{!v.sComments}" 
                                    label="{!v.sLabelComment}" 
                                    maxlength="1000"
                                    class="{! and(v.bHasError,empty(v.sComments)) ? 'slds-has-error required-asterisk' : 'required-asterisk'}"	                             
                                    />
            </lightning:layoutItem>
        </lightning:layout>
    </aura:if>
  
    <c:CC_AlternateProgramComponent sAppDetailId="{!v.sAppDetailId}"/>    
    </aura:if> 
</aura:component>